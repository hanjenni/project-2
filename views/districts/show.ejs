<%- include('../partials/header') %>

<!--clicked information-->
<!--make title appear later-->
<section class="infoPage">
<h1>School Information</h1>
<h4>District Name:</h4>
    <h2><%= districtInfo.districtName %> </h2>
<h4>Address:</h4>
  <h2> <%= districtInfo.address %> </h2>

</section>


<!--submit review box-->
<% if (user) { %>
  <section class="districtReview">
<br><br><h2>District Review</h2>
<form id="review-info" method="POST"
action="/districts/<%= districtInfo._id %>/reviews">
<label>Review:</label>
<textarea name="content"></textarea>
<label>Community Rating:</label>
<select name="comRating">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select>
<label>Admin Support Rating:</label>
<select name="adminRating">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select>
<label>Work-Life Balance Rating:</label>
<select name="workRating">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select>
<input type="submit" value="Add Review">
</form>
</form>
</section>

<!--show the reviews-->
<section class="reviewPage">
<% if (districtInfo.reviews.length) { %>
    <table class="reviewTable">
      <thead>
        <tr>
          <th>Member:</th>
          <th>Date:</th>
          <th>Community:</th>
          <th>Admin Support:</th>
          <th>Work-Life Balance:</th>
          <th>Review:</th>
        </tr>
      </thead>
      <tbody>
        <% let total = 0 %> 
        <% districtInfo.reviews.forEach(function(d) { %>
          <% total += d.comRating %> 
          <% total += d.adminRating %> 
          <% total += d.workRating %> 
         
          
          <tr>
            <td class="review-user"><img alt="avatar" src="<%= d.userAvatar %>" referrerpolicy="no-referrer" ><%= d.userName %></td>
            <td><%= d.createdAt.toLocaleDateString() %>
            <td><%= d.comRating %></td>
            <td><%= d.adminRating %></td>
            <td><%= d.workRating %></td>
            <td><%= d.content %></td>
            <td>
              <% if (user?._id.equals(d.user)) { %>
                <form action="/reviews/<%= d._id %>?_method=DELETE" method="POST">
                  <button type="submit">Delete</button>
                </form>

                <a href="/reviews/<%= d._id %>/edit"><button class="edit-button" type="button">Edit Post</button></a>
              <% } %>
            </td>
          
          </tr>


        <% }); %>
          <tr>
          <td colspan="3"></td>
          <td><strong><%= (total / districtInfo.reviews.length).toFixed(1) %></strong></td> %> </td>
          </tr>
        </tbody>
    </table>
  <% } else { %>
    <h5>No Reviews Yet</h5>
  <% } %>

  <% } %>

</section>